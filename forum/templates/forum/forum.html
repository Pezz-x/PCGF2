{% extends "base.html" %} {% block content %}
{% load static %}

<!-- Create Post Section -->
<section id="forum_page">
    <div id="create_post">
        <div class="card-body">
            <h2>Create a Post</h2>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {% load crispy_forms_tags %}
                {{ form|crispy }}
                <hr />
                <button id="publish_btn">Post</button>
            </form>
        </div>
    </div>

    </div>
        <!-- check if user is logged in-->
        {% if not user.is_authenticated %}
        <script>
            window.location.href = "{% url 'account_login' %}";
        </script>
        {% else %}
            <!-- load posts -->
            {% if posts %}
                {% for post in posts %}

                    <article id="forum_post">
                        <!-- Header: author info -->
                        <div id="post-header">
                            <div id="author_header">
                                <div>
                                    <!-- User profile picture -->
                                    <img
                                        src="{% if post.author.profile_photo %}{{ post.author.profile_photo.url }}{% else %}{% static 'images/PCGF2_default_profile.png' %}{% endif %}"
                                        alt="Profile photo"
                                        width="50"
                                        height="50"
                                    />
                                </div>
                                <div id="post_user_info">
                                    <!-- User info -->
                                    <strong id="post_user_name">
                                        {{ post.author }}
                                        {% if not user %}
                                            User with no name
                                        {% endif %}
                                    </strong>
                                    <div>
                                        <small>
                                            {% if post.author.relation_to_pcgf2 %}
                                                Relation: {{ post.author.get_relation_to_pcgf2_display }}
                                            {% else %}
                                                Relation: No relation to PCGF2 provided.
                                            {% endif %}
                                        </small>
                                    </div>
                                    <div>
                                        <small>{{ post.time_created|date:"F j, Y, g:i a" }}</small>
                                    </div>
                                </div>
                            </div>

                            <!-- edit/delete if owner -->
                            <div id="post_management">
                                {% if user.is_authenticated and post.author == user %}
                                    <div style="margin-top:0.5em;">
                                        <a href="{% url 'post_edit' post.slug %}">Edit</a> |
                                        <a href="{% url 'post_delete' post.slug %}">Delete</a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Body: image + preview text -->
                        <div id="post_body">
                            <div>
                                <h3>
                                    <a href="{% url 'post_detail' post.slug %}">{{ post.title }}</a>
                                </h3>
                            </div>

                            <!-- Post text body -->
                            <div class="post-text">
                                <p>
                                    {{ post.body|truncatechars:200 }}
                                </p>
                            </div>

                            <!-- Load image -->
                            {% if post.images %}
                                <div class="post-images">
                                    <a href="{% url 'post_detail' post.slug %}">
                                        <img src="{{ post.images.url }}" alt="{{ post.title }} images" width="400" />
                                    </a>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Footer: likes/comments -->
                        <div class="post-footer" style="margin-top:0.5em;">
                            <span>‚ù§Ô∏è {{ post.likes_count }}</span>
                            <span style="margin-left:1em;">üí¨ {{ post.comments_count }}</span>
                        </div>
                    </article>

                {% endfor %}
            {% else %}
                <p>No posts to show.</p>
            {% endif %}
        {% endif %}
    <div/>
</section>
{% endblock %}
